<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 7. Sync App Development</title><link rel="stylesheet" href="css/seamframework.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="OpenMobster - Mobile Cloud Platform"/><link rel="up" href="index.html" title="OpenMobster - Mobile Cloud Platform"/><link rel="prev" href="installation.html" title="Chapter 6. Production Mode Installation"/><link rel="next" href="mobilebean.html" title="Chapter 8. MobileBean"/></head><body><p id="title"><a href="http://www.seamframework.org" class="site_href"><strong>SeamFramework.org</strong></a><a href="http://www.seamframework.org/Documentation" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="installation.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="mobilebean.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="offlineapp"/>Chapter 7. Sync App Development</h2></div><div><div class="author"><h3 class="author"><span class="firstname">openmobster</span> <span class="surname">at gmail.com</span></h3><code class="email">&lt;<a class="email" href="mailto:openmobster@gmail.com">openmobster@gmail.com</a>&gt;</code></div></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="offlineapp.html#d0e1026">7.1. </a></span></dt><dt><span class="sect1"><a href="offlineapp.html#d0e1055">7.2. Tutorial</a></span></dt><dd><dl><dt><span class="sect2"><a href="offlineapp.html#d0e1058">7.2.1. Cloud-Side: Channel Development</a></span></dt><dt><span class="sect2"><a href="offlineapp.html#d0e1163">7.2.2. App/Device-Side: MobileBean component</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"/><p>
   		A native Mobile App runs within the constraints of its local runtime. A major advantage of this environment is access to local storage for data
associated with the App. If logic is the nervous system of an App, data is its life blood. Without the data, an App is lifeless. Local Storage
brings an App to life instantaneously. The closer this data is stored, the faster and better is the performance of the App.
   		</p><p>
   		A typical Mobile App has the following data-oriented requirements
   		</p><div class="itemizedlist"><ul><li>Data originates in the Cloud.</li><li>App related data is synchronized from the Cloud with the local storage over a network connection.</li><li>Any data state changes (add/update/delete) via the App are synchronized with the Cloud.</li><li>Any data state changes (add/update/delete) on the Cloud are pushed/synchronized with the device.</li><li>This data is available to the mobile App even in the event the Cloud is unavailable.</li></ul></div><p>
   		The <span class="bold"><strong>OpenMobster Cloud Platform</strong></span> uses a "Channel" component on the <span class="emphasis"><em>Cloud-side</em></span> and 
   		a <span class="emphasis"><em>MobileBean</em></span> component on the <span class="emphasis"><em>Device-side</em></span> to provide the above mentioned 
   		offline capabilities to an App
   		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1055"/>7.2. Tutorial</h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1058"/>7.2.1. Cloud-Side: Channel Development</h3></div></div></div><p>
   			A Channel serves as a gateway for integrating on-device model/data objects with the
 			server-side backend storage systems such as relational databases, content repositories, or 
    		Enterprise systems like CRMs, ERPs etc. It provides a simple CRUD (Create, Read, Update, and Delete)
    		interface to expose the backend data. The Channel is specifically designed such that the Developer does
    		not have to worry about any low-level state management, and synchronization issues.
   			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1063"/>7.2.1.1. Step 1:</h4></div></div></div><p>
   				Define a simple MobileBean to represent a data entity being mobilized. This MobileBean should adhere to the MobileBean specification
    			covered here: <a class="link" href="mobilebean.html" title="Chapter 8. MobileBean">Specification</a>
   				</p><p>
   				</p><pre class="programlisting">
import java.util.List;
import org.openmobster.cloud.api.sync.MobileBean;
import org.openmobster.cloud.api.sync.MobileBeanId;
public class DemoBean implements MobileBean 
{
	@MobileBeanId
	private String beanId;
	
	private String demoString; //used to demonstrate mobilizing a simple property of type 'String'
	
	private String[] demoArray; //used to demonstrate mobilizing of an indexed property that is an 'array'
	
	private List&lt;String&gt; demoList; //used to demonstrate mobilizing an indexed property that is a 'list'
	
	public DemoBean()
	{
		
	}

	public String getBeanId()
	{
		return beanId;
	}

	public void setBeanId(String beanId)
	{
		this.beanId = beanId;
	}

	public String getDemoString()
	{
		return demoString;
	}

	public void setDemoString(String demoString)
	{
		this.demoString = demoString;
	}

	public String[] getDemoArray()
	{
		return demoArray;
	}

	public void setDemoArray(String[] demoArray)
	{
		this.demoArray = demoArray;
	}

	public List&lt;String&gt; getDemoList()
	{
		return demoList;
	}

	public void setDemoList(List&lt;String&gt; demoList)
	{
		this.demoList = demoList;
	}
}
</pre><p>
  				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1076"/>7.2.1.2. Step 2:</h4></div></div></div><p>
   				Provide a Channel implementation that exposes this MobileBean via a CRUD interface.
   				</p><p>
   				</p><pre class="programlisting">
@ChannelInfo(uri="/offlineapp/demochannel", 
             mobileBeanClass="org.openmobster.core.examples.offlineapp.DemoBean")
public class DemoChannel implements Channel
   				</pre><p>
   				</p><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1086"/>7.2.1.2.1. bootup</h5></div></div></div><p>
   					This method provides a subset of the "MobileBean" instances associated with the said device. 
		They provide just enough information for an App to be functional. This helps with avoiding very long synchronization
		sessions. The other beans are loaded on-demand from there on
		</p><pre class="programlisting">
public List&lt;? extends MobileBean&gt; bootup() 
{
	List&lt;MobileBean&gt; list = new ArrayList&lt;MobileBean&gt;();
	
	//Just get only the top 5 beans to bootup the service on device side
	//This decision is App-specific
	for(int i=0; i&lt;5; i++)
	{
		DemoBean bean = this.demoRepository.getData().get(""+i);
		list.add(bean);
	}
	
	return list;
}
   				</pre><p>
   					</p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1094"/>7.2.1.2.2. readAll</h5></div></div></div><p>This method provides all the "MobileBean" instances associated with the said device.
   					</p><pre class="programlisting">
public List&lt;? extends MobileBean&gt; readAll() 
{		
	List&lt;MobileBean&gt; list = new ArrayList&lt;MobileBean&gt;();
	
	//Get All the Beans associated with this Channel for this Device
	Set&lt;String&gt; beanIds = this.demoRepository.getData().keySet();
	for(String beanId: beanIds)
	{
		list.add(this.demoRepository.getData().get(beanId));
	}
	
	return list;
}
   				</pre><p>
   					</p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1102"/>7.2.1.2.3. read</h5></div></div></div><p>
   					This method loads the particular "MobileBean" instance in question.
   					   					</p><pre class="programlisting">
public MobileBean read(String id) 
{		
	return this.demoRepository.getData().get(id);
}
   				</pre><p>
   					</p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1110"/>7.2.1.2.4. create</h5></div></div></div><p>
   					Creates a new instance of a "MobileBean" within the backend data service. This happens when a new instance is created
		on the device and synchronized back with the Cloud. It returns the unique id generated by the server and associated with this bean.
		   					   					</p><pre class="programlisting">
public String create(MobileBean mobileBean) 
{
	DemoBean newBean = (DemoBean)mobileBean;
	
	//Generate a new unique bean Id. This bean was created on the Device and is being
	//synchronized with the backend cloud service
	String newBeanId = String.valueOf(this.getDemoRepository().getData().size());
	newBean.setBeanId(newBeanId);
	
	this.demoRepository.getData().put(newBeanId, newBean);
	
	return newBeanId;
}
   				</pre><p>
   					</p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1118"/>7.2.1.2.5. update</h5></div></div></div><p>
   					Synchronizes the updated state of a bean from the device with the state on the Cloud.
   					</p><pre class="programlisting">
public void update(MobileBean mobileBean) 
{
	DemoBean updatedBean = (DemoBean)mobileBean;
	
	this.demoRepository.getData().put(updatedBean.getBeanId(), updatedBean);
}
   				</pre><p>
   					</p></div><div class="sect4" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1126"/>7.2.1.2.6. delete</h5></div></div></div><p>
   					Deletes a bean instance that is user confirmed to be deleted from the device.
   					</p><pre class="programlisting">
public void delete(MobileBean mobileBean) 
{		
	DemoBean deletedBean = (DemoBean)mobileBean;
	this.demoRepository.getData().remove(deletedBean.getBeanId());
}
   				</pre><p>
   					</p></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1134"/>7.2.1.3. Step 3:</h4></div></div></div><p>
   				Provide the META-INF/openmobster-config.xml that will deploy the "Channel" into the Cloud Server.
   				</p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;deployment xmlns="urn:jboss:bean-deployer:2.0"&gt;
   &lt;bean name="/offlineapp/demorepo" class="org.openmobster.core.examples.offlineapp.DemoDataRepository"/&gt;
    
   &lt;bean name="/offlineapp/demochannel" class="org.openmobster.core.examples.offlineapp.DemoChannel"&gt;
   		&lt;property name="demoRepository"&gt;&lt;inject bean="/offlineapp/demorepo"/&gt;&lt;/property&gt;
   &lt;/bean&gt;  
&lt;/deployment&gt;
   				</pre><p>
   				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1142"/>7.2.1.4. Step 4:</h4></div></div></div><p>
   				Package the the above classes and the corresponding META-INF/openmobster-config.xml into a simple <span class="emphasis"><em>jar</em></span> file.
   				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1150"/>7.2.1.5. Step 5:</h4></div></div></div><p>
   				Deploy this jar file into the "deploy" directory of your JBoss AS instance
   				</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1155"/>7.2.1.6. Putting it all together</h4></div></div></div><p>
   				 	The end-to-end Channel Example is located in the binary distribution at: 
   				 	<span class="bold"><strong>Samples/offlineapp/cloud</strong></span>
   				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1163"/>7.2.2. App/Device-Side: MobileBean component</h3></div></div></div><p>
   			On the device side, this data is accessible via the <span class="bold"><strong>org.openmobster.android.api.sync.MobileBean</strong></span> component.
	The device-side MobileBean is a generic component which exposes a Cloud-side MobileBean information through 
	a robust interface. Device-side MobileBean component semantic are covered here:<a class="link" href="mobilebean.html" title="Chapter 8. MobileBean">Specification</a>
   			</p><p>
   			Here are some simple methods to access a MobileBean on the device
   			</p><div class="itemizedlist"><ul><li>
   				readAll: Returns all MobileBean instances associated with a channel. Chances are some of the instances are only proxies that will be
		loaded seamlessly when they are really needed <span class="emphasis"><em>on-demand</em></span>. This process happens behind the scenes and there is nothing special a programmer needs to do.
		<pre class="programlisting">
MobileBean[] demoBeans = MobileBean.readAll("/offlineapp/demochannel");	
actions = new Vector();
int size = demoBeans.length;
for(int i=0; i&lt;size; i++)
{
	if(!demoBeans[i].isProxy())
	{
		actions.addElement(demoBeans[i].getValue("demoString"));
	}
	else
	{
		actions.addElement(demoBeans[i].getId()+": proxyState");
	}
}
   				</pre></li><li>
   				getValue: Reads the value associated with a field/property of an instance of a bean. A property expression is provided to access
		this information.
		<pre class="programlisting">
demoBeans[i].getValue("demoString");
   				</pre>
   				This particular method call reads the "demoString" property of the corresponding Cloud-Side MobileBean instance covered earlier.
   				</li><li>
   				setValue: Updates the field/property of an instance of a bean. A property expression and its value are provided.
   				<pre class="programlisting">
demoBeans[i].setValue("demoString", "new updated value");
   				</pre></li></ul></div><p>
   			For a more detailed coverage of the MobileBean usage, please see some example code in the binary distribution located at:
   			<span class="bold"><strong>Samples/offlineapp/app-android</strong></span>
   			</p></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="installation.html"><strong>Prev</strong>Chapter 6. Production Mode Installation</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="mobilebean.html"><strong>Next</strong>Chapter 8. MobileBean</a></li></ul></body></html>