<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 2. HelloSync - Simple Sync App Tutorial</title><link rel="stylesheet" href="css/seamframework.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="OpenMobster - Mobile Cloud Platform"/><link rel="up" href="index.html" title="OpenMobster - Mobile Cloud Platform"/><link rel="prev" href="androidsdk.html" title="Chapter 1. Installation"/><link rel="next" href="appcreator.html" title="Chapter 3. AppCreator - A Maven based App Development tool"/></head><body><p id="title"><a href="http://www.seamframework.org" class="site_href"><strong>SeamFramework.org</strong></a><a href="http://www.seamframework.org/Documentation" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="androidsdk.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="appcreator.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="hellosync"/>Chapter 2. HelloSync - Simple Sync App Tutorial</h2></div><div><div class="author"><h3 class="author"><span class="firstname">openmobster</span> <span class="surname">at gmail.com</span></h3><code class="email">&lt;<a class="email" href="mailto:openmobster@gmail.com">openmobster@gmail.com</a>&gt;</code></div></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="hellosync.html#d0e77">2.1. AppCreator Project</a></span></dt><dt><span class="sect1"><a href="hellosync.html#d0e113">2.2. Developing the Channel</a></span></dt><dd><dl><dt><span class="sect2"><a href="hellosync.html#d0e118">2.2.1. Step 1: Write the HelloSyncBean</a></span></dt><dt><span class="sect2"><a href="hellosync.html#d0e140">2.2.2. Step 2: Write the HelloSyncChannel</a></span></dt><dt><span class="sect2"><a href="hellosync.html#d0e234">2.2.3. Step 3: Configuration</a></span></dt></dl></dd><dt><span class="sect1"><a href="hellosync.html#d0e244">2.3. Developing the Android App</a></span></dt><dd><dl><dt><span class="sect2"><a href="hellosync.html#d0e249">2.3.1. Step 1: Write the HomeScreen</a></span></dt><dt><span class="sect2"><a href="hellosync.html#d0e274">2.3.2. Step 2: Configuration</a></span></dt></dl></dd><dt><span class="sect1"><a href="hellosync.html#d0e295">2.4. Running the App</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e77"/>2.1. AppCreator Project</h2></div></div></div><p>
   			The HelloSync App is created using the <a class="link" href="appcreator.html" title="Chapter 3. AppCreator - A Maven based App Development tool">AppCreator</a>. Here is brief explanation of the project structure
   			</p><div class="itemizedlist"><ul><li><span class="bold"><strong>cloud:</strong></span> Contains the src for the Cloud-side Channel component. Java code is located under <span class="emphasis"><em>src/main/java</em></span>, 
   					and configuration is located under <span class="emphasis"><em>src/main/resources</em></span>.
   				</li><li><span class="bold"><strong>app-android:</strong></span> Contains the src for the Android App. Java code is located under <span class="emphasis"><em>src/main/java</em></span>,
   					Configuration is located under <span class="emphasis"><em>src/main/resources/moblet-app</em></span>. Besides the OpenMobster component setup, the Android SDK specific setup is located under
   					<span class="emphasis"><em>AndroidManifest.xml, and res directory</em></span></li><li><span class="bold"><strong>moblet:</strong></span> This is an assembly component that packages this App into a jar file ready for deployment in a JBoss AS based OpenMobster instance.
   				</li></ul></div><p>
   		</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e113"/>2.2. Developing the <span class="bold"><strong>Channel</strong></span></h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e118"/>2.2.1. Step 1: Write the HelloSyncBean</h3></div></div></div><p>
   			The <span class="emphasis"><em>HelloSyncBean</em></span> is a simple annotated <span class="emphasis"><em>MobileBean</em></span> that carries the domain level information
   			that will be synchronized with the device. This information is encapsulated inside a <span class="emphasis"><em>MobileBean</em></span>
   			instance. It will be used by the native App on the device side. This bean implements the <span class="emphasis"><em>org.openmobster.server.api.model.MobileBean</em></span> interface.
   			This is a simple marker interface. It does not require any methods to be implemented.
   			</p><p>
</p><pre class="programlisting">
package com.hello.sync;

import org.openmobster.server.api.model.MobileBean;
import org.openmobster.server.api.model.MobileBeanId;

public class HelloSyncBean implements MobileBean 
{
	private static final long serialVersionUID = 1L;

	@MobileBeanId
	private String oid;
	
	private String message;
	
	public HelloSyncBean()
	{
		
	}

	public String getOid() 
	{
		return oid;
	}

	public void setOid(String oid) 
	{
		this.oid = oid;
	}

	public String getMessage() 
	{
		return message;
	}

	public void setMessage(String message) 
	{
		this.message = message;
	}
}

</pre><p>
   			</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e140"/>2.2.2. Step 2: Write the HelloSyncChannel</h3></div></div></div><p>
   			A Channel serves as a gateway for integrating on-device model/data objects with the
 			server-side backend storage systems such as relational databases, email servers, content repositories, or 
    		Enterprise systems like CRMs, ERPs etc. It provides a simple CRUD (Create, Read, Update, and Delete)
    		interface to expose the backend data. The Channel is specifically designed such that the Developer does
    		not have to worry about any low-level state management, and synchronization issues.
   			</p><p>
   			For sake of simplicity, we will only implement a small portion of the <span class="emphasis"><em>org.openmobster.server.api.model.Channel</em></span> interface.
   			A detailed explanation about the semantics of the Channel interface can be found <a class="ulink" href="http://openmobster.googlecode.com/svn/wiki/content/app-developer-guide/html/offlineapp.html">here</a>
   			</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e153"/>2.2.2.1. Implement the <span class="emphasis"><em>org.openmobster.server.api.model.Channel</em></span> interface</h4></div></div></div><pre class="programlisting">
package com.hello.sync;

import java.util.Date;
import java.util.List;
import java.util.ArrayList;

import org.openmobster.server.api.model.Channel;
import org.openmobster.server.api.model.ChannelInfo;
import org.openmobster.server.api.model.MobileBean;

import org.openmobster.core.security.device.Device;

@ChannelInfo(uri="hellosync", mobileBeanClass="com.hello.sync.HelloSyncBean")
public class HelloSyncChannel implements Channel 

</pre><p>
            		Annotate the channel class with <span class="emphasis"><em>org.openmobster.server.api.model.ChannelInfo</em></span> annotation.
            		</p><div class="itemizedlist"><ul><li><span class="bold"><strong>uri: </strong></span> Unique value for registering the channel with the Channel Framework.
            			</li><li><span class="bold"><strong>mobileBeanClass: </strong></span> Class of the <span class="emphasis"><em>MobileBean</em></span> that will be managed via this channel.
            			</li></ul></div><p>
            	</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e179"/>2.2.2.2. Implement <span class="emphasis"><em>bootup</em></span> method</h4></div></div></div><pre class="programlisting">
@Override
public List&lt;? extends MobileBean&gt; bootup() 
{
	List&lt;HelloSyncBean&gt; bootupBeans = new ArrayList&lt;HelloSyncBean&gt;();
	
	//Just using mock data...Usually this will extract the information from a backend service or database
	for(int i=0; i&lt;5; i++)
	{
		HelloSyncBean syncBean = new HelloSyncBean();
		
		syncBean.setOid(""+i);
		syncBean.setMessage("hello from "+syncBean.getOid());
		
		bootupBeans.add(syncBean);
	}
	
	return bootupBeans;
}

</pre><p>
				This method only returns the essential beans needed to make the App functional. It can be thought of as providing enough information for <span class="emphasis"><em>booting</em></span> up the App.
				The rest of the beans are synchronized silently in the background without requiring any manual intervention or docking the device to a desktop, etc.
				This allows instant usage of the App without having to wait a few hours for all the required data to be loaded.
			</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e192"/>2.2.2.3. Implement <span class="emphasis"><em>scanForNew</em></span> method</h4></div></div></div><pre class="programlisting">
@Override
public String[] scanForNew(Device device, Date lastScanTimestamp) 
{
	//In this example, it pushes something every scan..Just for push demo
	return new String[]{"push:1",
	"push:2"};
}
 
 </pre><p>
	 				This method checks with the backend service if a <span class="bold"><strong>new</strong></span> MobileBean instance has been created on the backend connected to by the channel.
					Based on that it would send the just new bean <span class="bold"><strong>ids</strong></span> back, or return null, if nothing new is available.
					If something new is available, this information is automatically synced and notified on the user's mobile device.
					If not, nothing happens on the device side.
					</p><div class="itemizedlist"><ul><li><span class="bold"><strong>device: </strong></span> provides the context around which device should this call apply to. Backend information is linked via the user
							identity associated with the device
						</li><li><span class="bold"><strong>lastScanTimestamp: </strong></span> provides when the last scan occurred. This way developer knows to only include beans that may have been created in
							the backend since this period in time.
						</li></ul></div><p>
	 			</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e218"/>2.2.2.4. Implement <span class="emphasis"><em>read</em></span> method</h4></div></div></div><pre class="programlisting">
@Override
public MobileBean read(String id) 
{
	//Just mock data....Usually the bean 
	//would be constructed using the data 
	//from a backend service or database
	HelloSyncBean syncBean = new HelloSyncBean();
	syncBean.setOid(id);
	syncBean.setMessage("hello from "+syncBean.getOid());
	
	return syncBean;
}

</pre><p>
					This method provides a fully loaded <span class="emphasis"><em>MobileBean</em></span> instance associated with the supplied <span class="emphasis"><em>id</em></span>.
				</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e234"/>2.2.3. Step 3: Configuration</h3></div></div></div><p>
   				Register this channel using the <span class="bold"><strong>cloud/src/resources/META-INF/openmobster-config.xml</strong></span> file.
   			</p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;deployment xmlns="urn:jboss:bean-deployer:2.0"&gt;
   &lt;bean name="hellosync" class="com.hello.sync.HelloSyncChannel"&gt;
   		&lt;depends&gt;services://MobileObjectMonitor&lt;/depends&gt;
   		&lt;depends&gt;services://MobileServiceMonitor&lt;/depends&gt;
   &lt;/bean&gt;  
&lt;/deployment&gt;
 
 </pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e244"/>2.3. Developing the <span class="bold"><strong>Android App</strong></span></h2></div></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e249"/>2.3.1. Step 1: Write the HomeScreen</h3></div></div></div><p>
   			Using the OpenMobster MVC Framework requires at the very least a very basic understanding of <a class="ulink" href="http://developer.android.com/guide/topics/fundamentals.html">Android Application Fundamentals</a>. A high level understanding of the concept
   			of <span class="bold"><strong>Activities</strong></span> is a bonus. The <span class="bold"><strong>HomeScreen</strong></span> component represents the main/home screen that is launched when the Android App is launched.
   			The full src code of the <span class="bold"><strong>HomeScreen</strong></span> component can be found <a class="ulink" href="http://openmobster.googlecode.com/svn/samples/hellosync/app-android/src/main/java/com/hello/sync/app/HomeScreen.java">here</a>. In order to keep the tutorial clean, we will only highlight the
   			aspect that deals with displaying the <span class="bold"><strong>HelloSyncBeans</strong></span> that are synchronized between the Cloud and the device. This is accomplished using
   			the following snippet of code:
   			</p><pre class="programlisting">
@Override
public void postRender()
{
	ListActivity listApp = (ListActivity)Registry.getActiveInstance().
	getContext();
	
	.............
	
	//Show the List of the "HelloSyncBeans" automatically synced and stored on the device
	//As a developer you only deal with the MobileBean component...
	//No low-level sync stuff to worry about
	if(MobileBean.isBooted("hellosync"))
	{
		MobileBean[] helloBeans = MobileBean.readAll("hellosync");
		
		//Preparing the ui with data stored in the beans..in the message field
		String[] ui = new String[helloBeans.length];
		for(int i=0,size=ui.length;i&lt;size;i++)
		{
			ui[i] = helloBeans[i].getValue("message");
		}
		
		//Showing the data in the list
		listApp.setListAdapter(new ArrayAdapter(listApp, 
	    android.R.layout.simple_list_item_1, 
	    ui));
	}
	
	............
}

</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e274"/>2.3.2. Step 2: Configuration</h3></div></div></div><p>
   				Configure this App with the on-device OpenMobster runtime using <span class="bold"><strong>app-android/src/resources/moblet-app/moblet-app.xml</strong></span>
   			</p><pre class="programlisting">
&lt;moblet-app&gt;
    &lt;!-- Registers the home/main screen of the app --&gt;
    &lt;bootstrap&gt;
    	&lt;screen&gt;com.hello.sync.app.HomeScreen&lt;/screen&gt;
    &lt;/bootstrap&gt;
    
    &lt;!-- Registers App Commands with the OpenMobster Command Framework. App Commands 
    are fired in response to events generated by user interactions 
    --&gt;
    &lt;commands&gt;
    	&lt;command id='/hellosync/reset'&gt;com.hello.sync.app.ResetChannel&lt;/command&gt;
    &lt;/commands&gt;
    
    &lt;!-- Registers the Cloud channels used by the App --&gt;
	&lt;channels&gt;
		&lt;channel&gt;hellosync&lt;/channel&gt;
	&lt;/channels&gt;					
&lt;/moblet-app&gt;

</pre><p>
				Android platform specific configuration can be found under: <span class="emphasis"><em>android-app/AndroidManifest.xml</em></span>, <span class="emphasis"><em>android-app/res/layout/home.xml</em></span>,
				and <span class="emphasis"><em>android-app/res/strings.xml</em></span>
			</p></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e295"/>2.4. Running the App</h2></div></div></div><div class="itemizedlist"><ul><li>
   				Start the Cloud Server. Under the HelloSync project, go to the <span class="bold"><strong>cloud</strong></span> directory, and type in:
   				<pre class="programlisting">				mvn -PrunCloud integration-test</pre></li><li>
   				Start the Android emulator. <a class="ulink" href="http://developer.android.com/guide/developing/tools/emulator.html">Here</a> are more details about using the Android Emulator
   				<pre class="programlisting">				emulator -avd droid</pre>
   				and
   				<pre class="programlisting">				ddms</pre></li><li>
   				Once the emulator is started and ddms is connected, install the development mode <span class="bold"><strong>DevCloud CloudManager App</strong></span> and
   				the <span class="bold"><strong>HelloSync App</strong></span>. Go to the <span class="bold"><strong>app-android</strong></span> directory and type in:
   				<pre class="programlisting">				mvn -Phot-deploy install</pre></li><li>
   				Activate the emulated device with the Cloud Server by launching the <span class="bold"><strong>DevCloud CloudManager App</strong></span> and clicking the <span class="emphasis"><em>Activate</em></span> option.
   			</li><li>
   				Launch the HelloSync App.
   			</li><li>
   				You can download the entire HelloSync App here: <a class="ulink" href="http://openmobster.googlecode.com/svn/samples/hellosync.zip">HelloSyncApp</a></li></ul></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="androidsdk.html"><strong>Prev</strong>Chapter 1. Installation</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="appcreator.html"><strong>Next</strong>Chapter 3. AppCreator - A Maven based App Develop...</a></li></ul></body></html>