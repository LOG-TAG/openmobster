<!DOCTYPE html> 
<html> 
	<head> 
	<title>OpenMobster CRUD App</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="jquery/jquery.mobile-1.1.0-rc.1.min.css" />
	<link rel="stylesheet" href="jquery/openmobster.css" />
	
	<script type="text/javascript" charset="utf-8" src="phonegap-1.4.1.js"></script>
	<script type="text/javascript" charset="utf-8" src="mobilebean.js"></script>
	
	<script src="jquery/jquery-1.7.1.min.js"></script>
	<script src="jquery/jquery.mobile-1.1.0-rc.1.min.js"></script>
	
	<script type="text/javascript" charset="utf-8">
		$(document).ready(function(){ initialize(); });
		
		function initialize()
		{
			window.plugins.mobileBeanPlugin.readall(channel,
			function(success)
			{
				alert(success);
			},
			function(error)
			{
				alert(error);
			}
		  );
		}
	</script>
</head> 
<body>
	<!-- tickets page -->
	<div data-role="page" data-transition="flip" id="tickets">
			<script>
				var load = function(){
				    var channel = 'phonegap_channel';
					var html = '<ul data-role="listview" data-theme="g">';
					
					  window.plugins.mobileBeanPlugin.readall(channel,
						function(success)
						{
							/*if(success == '0')
							{
								return;
							}
							
							var oids = JSON.parse(success);
							var length = oids.length;
							for(var i=0; i<length; i++)
							{
								var oid = oids[i];
								html += '<li><a href="#read_ticket?oid="+oid+" data-rel="dialog">Acura</a></li>';
							}*/
							
							alert(success);
						},
						function(error)
						{
							alert(error);
						}
					  );
	                  
	                  
	                  
	                  html += '</ul>';
	                  
	                  
	                  $("#tickets_content").html(html);
	                  
	                  $("#tickets_content ul").listview();
				};
				$('#tickets').live('pageshow',load);
				
				var transition = function(event,ui){
					var dataUrl = ui.nextPage.attr("data-url");
					if(dataUrl.indexOf("?oid") != -1)
					{
						//this is for reading a ticket, now extract the oid
						var index = dataUrl.indexOf('=');
						var oid = dataUrl.substring(index+1);
						
						$('#read_ticket_oid').val(oid);
					} 
				};
				$('#tickets').live('pagehide',transition);
			</script>
            <div class="ui-header" data-role="header" data-theme="b" data-position="fixed"> 
            	<h1>Tickets</h1> 
            	<nav data-role="navbar">
            		<ul>
            			<li><a href="#new_ticket" data-transition="flip">New Ticket</a></li>
            		</ul>
            	</nav>
            </div>
             
            <div data-role="content" id="tickets_content">
            </div>
            
            <div data-role="footer" data-theme="b" data-position="fixed">	
            </div>
      </div>
      
      <!-- New Ticket -->
      <div data-role="page" data-transition="flip" id="new_ticket">
            <script>
	      		var loadNewTicket = function(){ 
					};
				$('#new_ticket').live('pageshow',loadNewTicket);
				
				function submitNewTicket()
				{
					var title = $('#new_ticket_title').val();
					var customer = $('#new_ticket_customer').val();
					
					alert(title);
					alert(customer);
					
					$.mobile.changePage('#tickets','flip',true,true);
				}
			</script>
      		<div class="ui-header" data-role="header" data-theme="b" data-position="fixed"> 
            	<h1>New Ticket</h1> 
            	<nav data-role="navbar">
            		<ul>
            			<li id="new_ticket_save"><a href="javascript:submitNewTicket();" data-transition="flip">Save</a></li>
            			<li id="new_ticket_cancel"><a href="/" data-rel="back" data-transition="flip">Cancel</a></li>
            		</ul>
            	</nav>
            </div>
            
            <div data-role="content" id="new_ticket_content">
            	<form>
            		<label>Title:</label>
            		<input type="text" name="title" id="new_ticket_title"/><br/>
            		<label>Customer:</label>
            		<select name="customer" id="new_ticket_customer">
            			<option value="0">----Select----</option>
            			<option value="microsoft">Microsoft</option>
            			<option value="google">Google</option>
            			<option value="oracle">Oracle</option>
            			<option value="apple">Apple</option>
            		</select>
            		<label>Specialist:</label>
            		<select name="specialist" id="new_ticket_specialist">
            			<option value="0">----Select----</option>
            			<option value="microsoft">Microsoft</option>
            			<option value="google">Google</option>
            			<option value="oracle">Oracle</option>
            			<option value="apple">Apple</option>
            		</select>
            		<label>Comments:</label>
            		<input type="text" name="comments" id="new_ticket_comments"/><br/>
            	</form>
            </div>
            
            <div data-role="footer" data-theme="b" data-position="fixed">
            </div>
      </div>
      
      <!-- read ticket -->
      <div data-role="page" data-transition="flip" id="read_ticket">
            <script>
	      		var loadReadTicket = function(event,ui)
	      		{
	      			$("label[for='read_ticket_title']").html('Title:'+$('#read_ticket_oid').val());
	      			$("label[for='read_ticket_customer']").html('Customer: New Customer');
	      			$("label[for='read_ticket_specialist']").html('Specialist: New Specialist');
	      			$("label[for='read_ticket_comments']").html('Comments: New Comments');
				};
				$('#read_ticket').live('pageshow',loadReadTicket);
				
				function deleteTicket()
				{
					//$.mobile.showPageLoadingMsg("a","",false);
					//setTimeout(function(){$.mobile.hidePageLoadingMsg();},10000);
			
					$.mobile.changePage('#tickets','flip',true,true);
					alert("The Ticket was successfully deleted");
				}
			</script>
      		<div class="ui-header" data-role="header" data-theme="b" data-position="fixed"> 
            	<h1>Ticket</h1> 
            </div>
            
            <div data-role="content" id="new_ticket_content">
            	<form>
            		<input type="hidden" id="read_ticket_oid"/>
            		<label for="read_ticket_title"></label><br/>
            		<label for="read_ticket_customer"></label><br/>
            		<label for="read_ticket_specialist"></label><br/>
            		<label for="read_ticket_comments"></label>
            	</form>
            </div>
            
            <div data-role="footer" data-theme="b" data-position="fixed">
            	<nav data-role="navbar">
            		<ul>
            			<li id="read_ticket_ok"><a href="/" data-rel="back" data-transition="flip">OK</a></li>
            			<li id="read_ticket_update"><a href="/" data-rel="back" data-transition="flip">Update</a></li>
            			<li id="read_ticket_delete"><a href="javascript:deleteTicket();" data-transition="flip">Delete</a></li>
            		</ul>
            	</nav>
            </div>
      </div>
</body>
</html>