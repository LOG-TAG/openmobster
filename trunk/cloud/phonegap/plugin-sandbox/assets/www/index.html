<!DOCTYPE HTML>
<html>
<head>
<title>PhoneGap</title>
<script type="text/javascript" charset="utf-8" src="phonegap-1.4.1.js"></script>
<script type="text/javascript" charset="utf-8" src="mobilebean.js"></script>
<script type="text/javascript">
	function testArray(channel)
	{
		window.plugins.mobileBeanPlugin.readall(channel,
			function(success)
			{
				if(success == '0')
				{
					return;
				}
				
				var oids = JSON.parse(success);
				var length = oids.length;
				for(var i=0; i<length; i++)
				{
					var oid = oids[i];
					
					//insert into the string array and iterate through it
					window.plugins.mobileBeanPlugin.insertIntoArray(channel,oid,'customers',{'string':'insert'},
						function(arrayLength)
						{
							for(var j=0;j<arrayLength; j++)
							{
								var customerUri = 'customers['+j+']';
								window.plugins.mobileBeanPlugin.value(channel,oid,customerUri,
									function(value)
									{
										console.log(value);
									},
									function(error)
									{
										alert('StringArray:'+error);
									}
								);
							}
						},
						function(error)
						{
							alert('InsertIntoArray: '+error);
						}
					);
					
					//insert into the object array and iterate through it
					window.plugins.mobileBeanPlugin.insertIntoArray(channel,oid,'messages',{'from':'from@test.com','to':'to@test.com','message':'you got mail'},
						function(arrayLength)
						{
							for(var j=0;j<arrayLength; j++)
							{
								var fromUri = 'messages['+j+'].from';
								window.plugins.mobileBeanPlugin.value(channel,oid,fromUri,
									function(value)
									{
										console.log(value);
									},
									function(error)
									{
										alert('FromUri:'+error);
									}
								);
								
								var toUri = 'messages['+j+'].to';
								window.plugins.mobileBeanPlugin.value(channel,oid,toUri,
									function(value)
									{
										console.log(value);
									},
									function(error)
									{
										alert('ToUri:'+error);
									}
								);
								
								var messageUri = 'messages['+j+'].message';
								window.plugins.mobileBeanPlugin.value(channel,oid,messageUri,
									function(value)
									{
										console.log(value);
									},
									function(error)
									{
										alert('FromUri:'+error);
									}
								);
							}
						},
						function(error)
						{
							alert('InsertObjectArray: '+error);
						}
					);
				}
				
				//Commit here
				window.plugins.mobileBeanPlugin.commit(function(success)
				{
					alert('Commit successful');
				},
				function(error){});
			},
			function(error)
			{
				alert('ReadAll Error: '+error);
			}
		);
	}
	
	function addNewBean(channel)
	{
		window.plugins.mobileBeanPlugin.addNewBean(channel,
		function(tempOid)
		{
			console.log('Temporary Oid: '+tempOid);
		},
		function(error)
		{
			alert(error);
		});
		
		//Commit here
		window.plugins.mobileBeanPlugin.commit(function(success)
		{
			alert('Commit successful');
		},
		function(error){});
	}
	
	function deleteBean(channel)
	{
		window.plugins.mobileBeanPlugin.readall(channel,
			function(success)
			{
				if(success == '0')
				{
					return;
				}
				var oids = JSON.parse(success);
				var length = oids.length;
				for(var i=0; i<length; i++)
				{
					var oid = oids[i];
					
					//delete this bean
					window.plugins.mobileBeanPlugin.deleteBean(channel,oid,
						function(success){
						},
						function(error){
							alert(error);
						}
					);
				}
			},
			function(error)
			{
				alert(error);
			}
	   );
	   
	   //commit
	   window.plugins.mobileBeanPlugin.commit(function(success)
		{
			alert('Commit successful');
		},
		function(error){});
	}
	
	function updateBean(channel)
	{
		window.plugins.mobileBeanPlugin.readall(channel,
			function(success)
			{
				if(success == '0')
				{
					return;
				}
				
				var oids = JSON.parse(success);
				var length = oids.length;
				for(var i=0; i<length; i++)
				{
					var oid = oids[i];
					
					window.plugins.mobileBeanPlugin.updateBean(channel,oid,'title','title://updated',
					function(success){
						window.plugins.mobileBeanPlugin.value(channel,oid,'title',
									function(value)
									{
										console.log(value);
									},
									function(error)
									{
										alert('Reading the Title:'+error);
									}
								);
					},
					function(error){
						alert('Updating Title: '+error);
					}
					);
					
					
					//insert into the string array and iterate through it
					window.plugins.mobileBeanPlugin.arrayLength(channel,oid,'customers',
						function(arrayLength)
						{
							for(var j=0;j<arrayLength; j++)
							{
								var customerUri = 'customers['+j+']';
								window.plugins.mobileBeanPlugin.updateBean(channel,oid,customerUri,'customer://updated',
									function(value)
									{
										window.plugins.mobileBeanPlugin.value(channel,oid,customerUri,
											function(value)
											{
												console.log(value);
											},
											function(error)
											{
												alert('Read Error:'+error);
											}
										);
									},
									function(error)
									{
										alert('Update Error:'+error);
									}
								);
							}
						},
						function(error)
						{
							alert('ArrayLength: '+error);
						}
					);
					
					//insert into the object array and iterate through it
					window.plugins.mobileBeanPlugin.arrayLength(channel,oid,'messages',
						function(arrayLength)
						{
							for(var j=0;j<arrayLength; j++)
							{
								var fromUri = 'messages['+j+'].from';
								window.plugins.mobileBeanPlugin.updateBean(channel,oid,fromUri,'from@test.com',
									function(value)
									{
										window.plugins.mobileBeanPlugin.value(channel,oid,fromUri,
											function(value)
											{
												console.log(value);
											},
											function(error)
											{
												alert('FromUri Read:'+error);
											}
										);
									},
									function(error)
									{
										alert('FromUri Update:'+error);
									}
								);
								
								var toUri = 'messages['+j+'].to';
								window.plugins.mobileBeanPlugin.updateBean(channel,oid,toUri,'to@test.com',
									function(value)
									{
										window.plugins.mobileBeanPlugin.value(channel,oid,toUri,
											function(value)
											{
												console.log(value);
											},
											function(error)
											{
												alert('ToUri Read:'+error);
											}
										);
									},
									function(error)
									{
										alert('ToUri Update:'+error);
									}
								);
								
								var messageUri = 'messages['+j+'].message';
								window.plugins.mobileBeanPlugin.updateBean(channel,oid,messageUri,'message://updated',
									function(value)
									{
										window.plugins.mobileBeanPlugin.value(channel,oid,messageUri,
											function(value)
											{
												console.log(value);
											},
											function(error)
											{
												alert('MessageUri Read:'+error);
											}
										);
									},
									function(error)
									{
										alert('MessageUri Update:'+error);
									}
								);
							}
						},
						function(error)
						{
							alert('ArrayLength: '+error);
						}
					);
				}
				
				//Commit here
				window.plugins.mobileBeanPlugin.commit(function(success)
				{
					alert('Commit successful');
				},
				function(error){});
			},
			function(error)
			{
				alert('ReadAll Error: '+error);
			}
		);
	}
</script>
</head>
<body>
	<h1>Hello World</h1><br/>
	<input type='button' value='TestArray' onclick="javascript:testArray('phonegap_channel');"/><br/>
	<input type='button' value='TestAddNewBean' onclick="javascript:addNewBean('phonegap_channel');"/><br/>
	<input type='button' value='TestDeleteBean' onclick="javascript:deleteBean('phonegap_channel');"/><br/>
	<input type='button' value='TestUpdateBean' onclick="javascript:updateBean('phonegap_channel');"/>
</body>
</html>